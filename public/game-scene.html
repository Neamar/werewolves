<html>
<head><title>Awesome Game by MattÂ²</title>
<link rel="stylesheet" type="text/css" href="style.css" />
<body>

<pre id="events"></pre>

<!-- Death container -->
<div class='death-container' style='display: none;'>
  <div class='death-overlay'></div>
  <div class='death-notice'>
    You have died
    <br /><span class="reason"></span>
  </div>
</div>
<!-- End Death container -->

<!-- Model code -->
<div class="modal" id="modal" style="display: none;">
  <div class="modal-guts">
    <h1 id="action-title">Awesome Action!</h1>
    <p id="action-text">
      How now brown cow?
    </p>
    <input type="text" name="action" id="action"/>
  </div>
</div>
<!-- End modal code -->

<div class="grid">
  <div class="row" style="margin-top: auto">
    <div class="box box-1-5 list-of-deaths">
      <header>Dead Players</header>
      <div>
        <ul>
          <li>PsyKzz (Murdered by werewolf)</li>
          <li>PsyKzz (Hung by town)</li>
          <li>PsyKzz (Suicide)</li>
          <li>PsyKzz (Murdered by werewolf)</li>
        </ul>
      </div>
    </div>

    <div class="box-1-6 row">
      <div class="box day-night">
       <span id='night'><img src="img/moon.png"></span>
        <span id='day'><img src="img/sun.png"></span>
      </div>

      <div class="box player-role">
        <header>Role</header>
        <div>
          Your role is <span id="role">unassigned</span>.
        </div>
      </div>
    </div>
  </div>
  <br />
  <div class="row" style="position: absolute; bottom: 30px;">
<!--     <div class="box box-1-5 ">
      <pre>
        o
       \|/
        /\
      </pre>
    </div> -->

    <div class="box box-4-5 ">
      <header>Chat</header>
      <div id='chat-box'></div>
      <input type="text" id="chat-input" />
      <input type="submit" id="chat-send" />

    </div>

    <div class="box box-1-6 ">
      <header>Players</header>
      <div>
        <ul>
          <li>Game is still being created</li>
        </ul>
      </div>
    </div>

  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
<script src="/scripts/UIHelper.js"></script>
<script src="/scripts/Player.js"></script>
<script>
"use strict";
/* global io, $ */

var currentActionId;
var gameStarted = false;
var UI = new UIHelper();
var socket = io();

var player = new Player();

UI.showModal({title: "What's your name", content: "Pick a name to be known as in town"})

$("#action").on('keyup', function(e) {
  if(e.keyCode === 13 && this.value !== "") {
    UI.hideModal();

    if (gameStarted)
      socket.emit(currentActionId, this.value);
    else
      socket.emit('join', this.value);
      player.setName(this.value);
  }
});


var $chat = $('#chat-box');
var $chatSend = $('#chat-send');
var $chatInput = $('#chat-input');
$chatSend.on('click', function() {
  if($chatInput.val()) {
    UI.addChatMessage(player.name, $chatInput.val())
  }
})
socket.on("chat event", function(msg) {
  $('<p></p>').text(msg).appendTo($chat);
});

socket.on("game event", function(msg) {
  UI.debug(msg);

  // Did someone die
  if(msg.type === 'killed') {
    UI.addDeaths(msg.killed);
  }

 // Did you die
  if(msg.type === 'death') {
    UI.playerDeath();
  }

  // update role information
  if(msg.type === "start" && msg.role !== undefined) {
    UI.updateRole(msg.role);
    UI.updatePlayers(msg.players);
    UI.updateUI('night');
    gameStarted = true;
  }

  // update time
  if(msg.type === 'timechange') {
    UI.updateUI(msg.time);
  }

  if(msg.type === "rfa") {
    currentActionId = msg.identifier;
    UI.showModal({title: msg.title, content: msg.description});

  }
});
</script>

</body>
</html>
